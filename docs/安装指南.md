# 安装指南

## 系统要求

### 最低要求
- **操作系统**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **Python**: 3.8 或更高版本
- **内存**: 至少 8GB RAM
- **存储**: 至少 5GB 可用空间
- **网络**: 稳定的互联网连接（用于下载模型）

### 推荐配置
- **操作系统**: Windows 11, macOS 12+, Ubuntu 20.04+
- **Python**: 3.9 或 3.10
- **内存**: 16GB RAM 或更多
- **存储**: 10GB 可用空间
- **GPU**: NVIDIA GPU with CUDA 11.0+ (可选，用于加速)

## 安装方法

### 方法一：使用 Conda (推荐)

1. **安装 Miniconda**
   ```bash
   # 下载并安装 Miniconda
   # Windows: https://docs.conda.io/en/latest/miniconda.html
   # macOS: https://docs.conda.io/en/latest/miniconda.html
   # Linux: https://docs.conda.io/en/latest/miniconda.html
   ```

2. **创建环境**
   ```bash
   # 克隆项目
   git clone https://github.com/your-username/search-keyword-similarity.git
   cd search-keyword-similarity
   
   # 创建conda环境
   conda env create -f environment.yml
   
   # 激活环境
   conda activate similarity
   ```

3. **验证安装**
   ```bash
   python -c "import torch; print(f'PyTorch版本: {torch.__version__}')"
   python -c "import transformers; print(f'Transformers版本: {transformers.__version__}')"
   ```

### 方法二：使用 pip + venv

1. **创建虚拟环境**
   ```bash
   # 克隆项目
   git clone https://github.com/your-username/search-keyword-similarity.git
   cd search-keyword-similarity
   
   # 创建虚拟环境
   python -m venv venv
   
   # 激活环境
   # Windows:
   venv\Scripts\activate
   # macOS/Linux:
   source venv/bin/activate
   ```

2. **安装依赖**
   ```bash
   # 升级pip
   pip install --upgrade pip
   
   # 安装依赖
   pip install -r requirements.txt
   ```

3. **验证安装**
   ```bash
   python -c "import torch; print(f'PyTorch版本: {torch.__version__}')"
   python -c "import transformers; print(f'Transformers版本: {transformers.__version__}')"
   ```

### 方法三：Docker (高级用户)

1. **创建 Dockerfile**
   ```dockerfile
   FROM python:3.9-slim
   
   WORKDIR /app
   COPY requirements.txt .
   RUN pip install -r requirements.txt
   
   COPY . .
   CMD ["python", "run_safe.py"]
   ```

2. **构建和运行**
   ```bash
   docker build -t similarity-tool .
   docker run -it --rm -v $(pwd)/input:/app/input -v $(pwd)/output:/app/output similarity-tool
   ```

## 模型下载

### 自动下载
首次运行程序时，会自动下载 `text2vec-bge-large-chinese` 模型（约1.5GB）。

### 手动下载
如果自动下载失败，可以手动下载：

1. **访问模型页面**
   ```
   https://huggingface.co/BAAI/bge-large-zh-v1.5
   ```

2. **下载模型文件**
   - 下载 `config.json`
   - 下载 `pytorch_model.bin` 或 `model.safetensors`
   - 下载 `tokenizer.json`
   - 下载 `tokenizer_config.json`

3. **放置模型文件**
   ```
   项目根目录/
   └── models/
       └── text2vec-bge-large-chinese/
           ├── config.json
           ├── pytorch_model.bin
           ├── tokenizer.json
           └── tokenizer_config.json
   ```

4. **配置模型路径**
   在 `config.py` 中设置：
   ```python
   MODEL_PATH = './models/text2vec-bge-large-chinese'
   ```

## 环境配置

### 环境变量
```bash
# 设置模型路径
export MODEL_PATH="/path/to/your/model"

# 设置设备类型
export DEVICE="cuda"  # 或 "cpu"

# 设置批次大小
export BATCH_SIZE="32"
```

### 配置文件
编辑 `config.py` 文件：
```python
class Config:
    # 模型路径
    MODEL_PATH = os.getenv('MODEL_PATH', './models/text2vec-bge-large-chinese')
    
    # 设备选择
    DEVICE = os.getenv('DEVICE', 'cuda' if torch.cuda.is_available() else 'cpu')
    
    # 批次大小
    BATCH_SIZE = int(os.getenv('BATCH_SIZE', '32'))
```

## 常见问题

### 1. 依赖安装失败

**问题**: `pip install torch` 失败
**解决**: 使用官方命令安装PyTorch
```bash
# CUDA 11.8
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# CPU only
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

**问题**: `numpy` 版本冲突
**解决**: 先安装numpy
```bash
pip install numpy==1.21.2
pip install -r requirements.txt
```

### 2. 模型下载失败

**问题**: 网络连接超时
**解决**: 使用代理或镜像
```bash
# 设置代理
export HTTP_PROXY="http://proxy.example.com:8080"
export HTTPS_PROXY="http://proxy.example.com:8080"

# 或使用镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ transformers
```

### 3. 内存不足

**问题**: 运行时内存不足
**解决**: 使用CPU模式或减少批次大小
```python
# 在config.py中设置
BATCH_SIZE = 8  # 减少批次大小
DEVICE = 'cpu'  # 使用CPU模式
```

### 4. CUDA版本不兼容

**问题**: CUDA版本错误
**解决**: 检查版本兼容性
```bash
# 检查CUDA版本
nvidia-smi

# 检查PyTorch CUDA版本
python -c "import torch; print(torch.version.cuda)"
```

## 验证安装

运行以下命令验证安装是否成功：

```bash
# 检查Python版本
python --version

# 检查依赖包
python -c "
import torch
import transformers
import pandas
import numpy
print('所有依赖包安装成功！')
print(f'PyTorch: {torch.__version__}')
print(f'Transformers: {transformers.__version__}')
print(f'Pandas: {pandas.__version__}')
print(f'NumPy: {numpy.__version__}')
"

# 运行测试
python run_safe.py --test
```

## 下一步

安装完成后，请查看：
- [使用指南](使用指南.md) - 了解如何使用工具
- [配置说明](配置说明.md) - 了解各种配置选项
- [故障排除](故障排除.md) - 解决常见问题
